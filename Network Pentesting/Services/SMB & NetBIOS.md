Port: TCP 139,445; UDP 137
Samba Config File: `/etc/samba/smb.conf`

- SMBv1 -> allows anonymous access -> enum users

Currently connected shares
```bash
smbstatus
```
Hostname connection 
```bash
nmblookup -A 10.129.14.128
```
### Windows Machine
View shares
```cmd
net view <TARGET>
```
Using shares
```cmd
net use K:\\10.4.25.4\K$
net use D:\\10.4.25.4\Documents
```
### SMB Remote Management
NOTE: psexec will always attempt to return as `NT_AUTHORITY\System` on admin accounts, use other.
```bash
impacket-psexec <domain>/<user>@<ip> 
impacket-psexec active.htb/administrator@10.10.10.100

smbexec <USERNAME>:<PASS>@<TARGET>
```
### SMBclient
List shares using **Null session**.
```bash
smbclient -L [target] -N
```
List shares using **authentication.**
```bash
smbclient -L [target] -U [username]%[pwd]
```
**Connecting** to SMB server using Null session
```bash
smbclient \\\\[target]\[share] -N 
smbclient //[target]/[share] -N
```
### SMBmap
SMBMap tool for connecting, interface for interacting with the SMB shares of certain accounts.
```bash
smbmap -u [username] -p [password] -H [target] -d [domain]
```
Checking for Null sessions, if **IPC$ â†’ Null sessions allowed**
```bash
smbmap -H [target]
```
Executing **commands** 
```bash
smbmap -u [username] -p [password] -H [target] -x [powershell command]
```
Listing the **drive** available on the shares.
```bash
smbmap -u [username] -p [password] -H [target] -L
```
Reading, **listing files** and directories on the system (like the ls, and the dir command)
```bash
smbmap -u [username] -p [password] -H [target] -r '[PATH]'
```
**Uploading files** onto the share
```bash
smbmap -u [username] -p [password] -H [target] --upload 
'[location file]' '[destination]'
```
**Downloading** files from the share (getting the file)
```bash
smbmap -u [username] -p [password] -H [target] --download '[PATH]'
```
### RPCclient
Connecting a **Null session** to an SMB server
```bash
rpcclient -U [username] -N [target]
```
Finding **information about the server**
```bash
srvinfo
```
Provides domain, server and user information of deployed domains
```bash
querydominfo
```
Enumerates all available shares
```bash
netshareenumall
```
Provide information about a specific share.
```bash
netsharegetinfo <share>
```
Provide information about a specific user
```bash
queryuser <RID>
```
Enumerating domain **users**
```bash
enumdomusers
```
Finding **users S-ID**, admin accounts are usually Linux machine
```bash
lookupnames [users]
```
Finding **domain groups** within the server.
```bash
enumdomgroups
```
### Nmap
NetBIOS information
```bash
nmap -p 137 -sU --script nbstat.nse <TARGET>
```
Protocol version
```bash
nmap -p 139,445 --script smb-protocols 10.129.14.128
```
Security Mode
```bash
nmap -p 139,445 --script smb-security-mode 10.129.14.128
```
SMB sessions enumeration (finding which accounts have been **logged in**), will find more information when pass in more privilege accounts.
```bash
nmap -p [port number] --script smb-enum-sessions [target]
```
Finding drives and files that are **shared** with the user account. Account guest is default.
```bash
nmap -p [port number] --script smb-enum-shares [target]
```
**Users** that exist on the target machine.
```bash
nmap -p [port number] --script smb-enum-users [target]
```
Information about the **server.**
```bash
nmap -p [port number] --script smb-server-stats [target]
```
Information about the different **domains** and domain configurations
```bash
nmap -p [port number] --script smb-enum-domains [target]
```
Different **groups** within the server.
```bash
nmap -p [port number] --script smb-enum-groups [target]
```
**Services** running on the server
```bash
nmap -p [port number] --script smb-enum-services [target]
```
**Tree listing** of all the files and directories within the share. Much like the dir command in power shell
```bash
nmap -p [port number] --script smb-enum-shares,smb-ls [target]
```
OS discovery for protocol version and os enumeration
```bash
nmap -p [port number] --script smb-os-discovery [target]
```
MS17-010 checker
```bash
nmap -p 139,445 --script smb-vuln-ms17-010 10.129.14.128
```
### Metasploit
SMB **version and OS discovery** module.
```bash
auxiliary/scanner/smb/smb_version
```
Check if **SMB 2 dialect** is supported.
```bash
auxiliary/scanner/smb/smb2
```
Enumerating **shares** on SMB server.
```bash
auxiliary/scanner/smb/smb_enumshares
```
**Brute forcing** SMB login
```bash
auxiliary/scanner/smb/smb_login
```
SMB **pipe service** enumeration
```bash
auxiliary/scanner/smb/pipe_auditor
```
Enumerating **users** on SMB server.
```bash
auxiliary/scanner/smb/smb_enumusers
```
MS17-010 Check
```bash
auxiliary/scanner/smb/smb_ms17_010
```
### RID Brute Forcing/Cycling
(samrdump.py) RID Cycling
```bash
samrdump.py '10.129.14.128'
```
(nxc) RID Cycling
```bash
nxc smb 10.129.14.128 -u '.' -p '.' --rid-brute
```
### Enum4linux-NG
(enum4linux-ng) Samba/SMB automated enumeration + RID Cycling
```bash
enum4linux-ng -AR '10.129.14.128'
```